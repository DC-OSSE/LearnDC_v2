?select
??select
?dplyr select
?dplyr::select
?read.json
??read json
source("U:/R/tomkit.R")
library(jsonlite)
library(reshape2)
library(dplyr)
mgp <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_state_longitudinal]")
minmax <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_minmax]")
head(minmax)
head(mgp)
mgp <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_longitudinal]")
head(mgp)
head(mgp,50)
mgp <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_longitudinal]")
mgp <- subset(mgp, subgroup %notin% c("Not-LEP","Not-Economy","Not-SPED"))
head(mgp,50)
mgp$mgp_1yr[which(is.na(mgp$mgp_1yr))] <- 'null'
mgp$mgp_2yr[which(is.na(mgp$mgp_2yr))] <- 'null'
mgp$school_code <- sapply(mgp$school_code, leadgr, 4)
head(mgp,50)
mgp <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_state_longitudinal]")
head(mgp,50)
minmax <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_minmax]")
mgp <- merge(mgp, minmax, by = c("year","subgroup","subject"), all.x=TRUE)
head(mgp,20)
table(mgp$subgroup)
mgp
mgp <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_state_longitudinal]")
source("U:/R/tomkit.R")
library(jsonlite)
library(reshape2)
library(dplyr)
mgp <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_state_longitudinal]")
mgp <- subset(mgp, subgroup %notin% c("Not-LEP","Not-Economy","Not-SPED"))
mgp <- subset(mgp, group_fay_size >= 10)
mgp$mgp_1yr[which(is.na(mgp$mgp_1yr))] <- 'null'
mgp$mgp_2yr[which(is.na(mgp$mgp_2yr))] <- 'null'
mgp$school_code <- sapply(mgp$school_code, leadgr, 4)
key_index <- c(1,2,3)
value_index <- c(6,7)
table(mgp$school_code)
head(mgp)
setwd("U:/LearnDC ETL V2/MGP Exhibit/JSON ETL")
source("U:/R/tomkit.R")
library(jsonlite)
library(reshape2)
library(dplyr)
mgp <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_longitudinal]")
mgp <- subset(mgp, subgroup %notin% c("Not-LEP","Not-Economy","Not-SPED"))
# setwd('U:/LearnDC ETL V2/Export/CSV/school')
# write.csv(susp_wide, "Equity_Report_MGP_School.csv", row.names=FALSE)
mgp <- subset(mgp, group_fay_size >= 10)
# mgp$mgp_1yr[which(is.na(mgp$mgp_1yr))] <- 'null'
# mgp$mgp_2yr[which(is.na(mgp$mgp_2yr))] <- 'null'
mgp$school_code <- sapply(mgp$school_code, leadgr, 4)
key_index <- c(1,2,3)
value_index <- c(6,7)
i <- "0101"
i
.tmp <- subset(mgp, school_code == i)
dim(.tmo)
dim(.tmp)
.nested_list <- lapply(1:nrow(.tmp), FUN = function(i){
list(key = list(.tmp[i,key_index]),
val = list(.tmp[i,value_index]))
})
.json <- toJSON(.nested_list)
.json
.json <- gsub("[[","",.json, fixed=TRUE)
.json <- gsub("]]","",.json, fixed=TRUE)
.json
?toJSON
.nested_list <- lapply(1:nrow(.tmp), FUN = function(i){
list(key = list(.tmp[i,key_index]),
val = list(.tmp[i,value_index]))
})
.json <- toJSON(.nested_list, na=null)
.nested_list <- lapply(1:nrow(.tmp), FUN = function(i){
list(key = list(.tmp[i,key_index]),
val = list(.tmp[i,value_index]))
})
.json <- toJSON(.nested_list, na="null")
.json
