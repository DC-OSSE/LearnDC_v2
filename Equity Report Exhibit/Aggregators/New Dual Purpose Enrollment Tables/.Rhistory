?select
??select
?dplyr select
?dplyr::select
?read.json
??read json
source("U:/R/tomkit.R")
library(jsonlite)
library(reshape2)
library(dplyr)
mgp <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_state_longitudinal]")
minmax <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_minmax]")
head(minmax)
head(mgp)
mgp <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_longitudinal]")
head(mgp)
head(mgp,50)
mgp <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_longitudinal]")
mgp <- subset(mgp, subgroup %notin% c("Not-LEP","Not-Economy","Not-SPED"))
head(mgp,50)
mgp$mgp_1yr[which(is.na(mgp$mgp_1yr))] <- 'null'
mgp$mgp_2yr[which(is.na(mgp$mgp_2yr))] <- 'null'
mgp$school_code <- sapply(mgp$school_code, leadgr, 4)
head(mgp,50)
mgp <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_state_longitudinal]")
head(mgp,50)
minmax <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_minmax]")
mgp <- merge(mgp, minmax, by = c("year","subgroup","subject"), all.x=TRUE)
head(mgp,20)
table(mgp$subgroup)
mgp
mgp <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_state_longitudinal]")
source("U:/R/tomkit.R")
library(jsonlite)
library(reshape2)
library(dplyr)
mgp <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_state_longitudinal]")
mgp <- subset(mgp, subgroup %notin% c("Not-LEP","Not-Economy","Not-SPED"))
mgp <- subset(mgp, group_fay_size >= 10)
mgp$mgp_1yr[which(is.na(mgp$mgp_1yr))] <- 'null'
mgp$mgp_2yr[which(is.na(mgp$mgp_2yr))] <- 'null'
mgp$school_code <- sapply(mgp$school_code, leadgr, 4)
key_index <- c(1,2,3)
value_index <- c(6,7)
table(mgp$school_code)
head(mgp)
source("U:/R/tomkit.R")
library(jsonlite)
library(reshape2)
library(dplyr)
mgp <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_state_longitudinal]")
minmax <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_minmax]")
dim(mgp)
dim(minmax)
mgp <- merge(mgp, minmax, by = c("year","subgroup","subject"), all.x=TRUE)
dim(mgp)
source("U:/R/tomkit.R")
enr <- sqlQuery(dbrepcard_prod, "SELECT * FROM [dbo].[enrollment_state_exhibit]")
pcsb_demo <- read.csv("pcsb_demo_insert_11-20-2014.csv")
pcsb_demo$subgroup[which(pcsb_demo$subgroup == "Female")] <- "FEMALE"
pcsb_demo$subgroup[which(pcsb_demo$subgroup == "Male")] <- "MALE"
source("U:/R/tomkit.R")
library(dplyr)
setwd("U:/LearnDC ETL V2/Equity Report Exhibit/Aggregators/New Dual Purpose Enrollment Tables")
pcsb_demo <- read.csv("pcsb_demo_insert_11-20-2014.csv")
pcsb_demo$subgroup[which(pcsb_demo$subgroup == "Female")] <- "FEMALE"
pcsb_demo$subgroup[which(pcsb_demo$subgroup == "Male")] <- "MALE"
pcsb_agg <- pcsb_demo %>%
group_by(subgroup) %>%
summarize(enrollment=sum(pcsb_enroll))
pcsb_agg$sector <- "PCS"
dcps_enr <- sqlQuery(dbrepcard_prod, "SELECT subgroup, enrollment FROM [dbo].[enrollment_lea_exhibit] WHERE lea_code = 1 and year = '2013' and grade = 'All'")
dcps_enr <- subset(dcps_enr, subgroup %in% pcsb_agg$subgroup)
dcps_enr$sector <- "DCPS"
both_sector <- rbind(dcps_enr, pcsb_agg)
state_agg <- both_sector %>%
group_by(subgroup) %>%
summarize(enrollment = sum(enrollment))
state_agg$total_agg_enroll <- 41827 + 41086
state_agg$year <- 2013
state_agg$grade <- "All"
state_agg$Pct <- state_agg$enrollment/state_agg$total_agg_enroll
state_agg$enrollment <- state_agg$Pct
state_agg <- subset(state_agg, select=c(year, grade, subgroup, enrollment))
state_all <- read.csv("1_line.csv")
state_agg <- rbind(state_agg, state_all)
enr <- sqlQuery(dbrepcard_prod, "SELECT * FROM [dbo].[enrollment_state_exhibit]")
enr <- subset(enr, (year==2013 & subgroup=='All' & grade!='All') & (year==2013 & subgroup=='All'))
state_agg <- rbind(state_agg, enr)
state_agg
sqlSave(dbrepcard_prod, enr, tablename = "enrollment_state_exhibit_pcsb_alterations", rownames = FALSE)
sqlSave(dbrepcard_prod, state_agg, tablename = "enrollment_state_exhibit_pcsb_alterations", rownames = FALSE)
sqlSave(dbrepcard_prod, state_agg, tablename = "enrollment_state_exhibit_pcsb_alterations", rownames = FALSE)
