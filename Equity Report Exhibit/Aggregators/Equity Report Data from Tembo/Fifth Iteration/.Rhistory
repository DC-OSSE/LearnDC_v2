?select
??select
?dplyr select
?dplyr::select
?read.json
??read json
source("U:/R/tomkit.R")
library(jsonlite)
library(reshape2)
library(dplyr)
mgp <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_state_longitudinal]")
minmax <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_minmax]")
head(minmax)
head(mgp)
mgp <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_longitudinal]")
head(mgp)
head(mgp,50)
mgp <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_longitudinal]")
mgp <- subset(mgp, subgroup %notin% c("Not-LEP","Not-Economy","Not-SPED"))
head(mgp,50)
mgp$mgp_1yr[which(is.na(mgp$mgp_1yr))] <- 'null'
mgp$mgp_2yr[which(is.na(mgp$mgp_2yr))] <- 'null'
mgp$school_code <- sapply(mgp$school_code, leadgr, 4)
head(mgp,50)
mgp <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_state_longitudinal]")
head(mgp,50)
minmax <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_minmax]")
mgp <- merge(mgp, minmax, by = c("year","subgroup","subject"), all.x=TRUE)
head(mgp,20)
table(mgp$subgroup)
mgp
mgp <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_state_longitudinal]")
source("U:/R/tomkit.R")
library(jsonlite)
library(reshape2)
library(dplyr)
mgp <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_state_longitudinal]")
mgp <- subset(mgp, subgroup %notin% c("Not-LEP","Not-Economy","Not-SPED"))
mgp <- subset(mgp, group_fay_size >= 10)
mgp$mgp_1yr[which(is.na(mgp$mgp_1yr))] <- 'null'
mgp$mgp_2yr[which(is.na(mgp$mgp_2yr))] <- 'null'
mgp$school_code <- sapply(mgp$school_code, leadgr, 4)
key_index <- c(1,2,3)
value_index <- c(6,7)
table(mgp$school_code)
head(mgp)
source("U:/R/tomkit.R")
library(jsonlite)
library(reshape2)
library(dplyr)
mgp <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_state_longitudinal]")
minmax <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_minmax]")
dim(mgp)
dim(minmax)
mgp <- merge(mgp, minmax, by = c("year","subgroup","subject"), all.x=TRUE)
dim(mgp)
setwd("U:/LearnDC ETL V2/MGP Exhibit/JSON ETL")
source("U:/R/tomkit.R")
library(jsonlite)
library(reshape2)
library(dplyr)
mgp <- sqlQuery(dbrepcard, "SELECT * FROM [dbo].[mgp_longitudinal]")
mgp <- subset(mgp, subgroup %notin% c("Not-LEP","Not-Economy","Not-SPED"))
mgp
head(mgp)
mgp[which(mgp$school_code==3068)]
mgp[mgp$school_code==3068]
[mgp$school_code==3068]
mgp$school_code==3068
mgp(mgp$school_code==3068)
mgp[mgp$school_code==3068]
mgp[which(mgp$school_code==3068)]
mgp
which(mgp$school_code==3068)
mgp[mgp$school_code==3068]
mgp[mgp$school_code==3068,]
m1 <- mgp[mgp$school_code==3068,]
m1
m1[, order(m1$year)]
m1[order(m1$year),]
m1[order(m1$year, m1$subject),]
?order
m1 <- mgp[mgp$school_code==3068 & mgp$school==107,]
m1[order(m1$year, m1$subject),]
m1
m1 <- mgp[(mgp$school_code==3068 & mgp$school==107),]
m1
m1 <- mgp[(mgp$school_code==3068 & mgp$school==1207),]
m1
m1 <- mgp[(mgp$school_code==1207),]
m1[order(m1$year, m1$subject),]
setwd("U:/LearnDC ETL V2/Equity Report Exhibit/Aggregators/Equity Report Data from Tembo/Fifth Iteration")
susp_counts <- read.csv("BothSectors-SuspensionRates_1plus_11plus.csv")
susp_counts$Month <- ""
susp_counts <- select(susp_counts, Key, School_Code, School_Year, Student_Group, Metric, SchoolScore, AverageScore, Month, ReportType, NSize)
head(susp_counts)
table(susp_counts$Student_Group)
table(susp_counts$School_YEar)
table(susp_counts$School_Year)
pcs_total_susp <- read.csv("PCS Total Suspensions.csv")
pcs_total_susp$SCHOOL_NAME <- NULL
colnames(pcs_total_susp) <- c("School_Code","SchoolScore")
pcs_total_susp$Student_Group <- "All Students"
pcs_total_susp$School_Year <- "2013-14"
pcs_total_susp$ReportType <- "External"
pcs_total_susp$AverageScore <- NA
pcs_total_susp$Metric <- "Total Suspensions"
pcs_total_susp$Month <- ""
pcs_total_susp$NSize <- NA
pcs_total_susp$Key <- paste(pcs_total_susp$School_Code, pcs_total_susp$School_Year, pcs_total_susp$Student_Group, pcs_total_susp$Metric, pcs_total_susp$ReportType)
pcs_total_susp <- select(pcs_total_susp, Key, School_Code, School_Year, Student_Group, Metric, SchoolScore, AverageScore, Month, ReportType, NSize)
head(pcs_total_susp)
table(pcs_total_susp$School_Year)
susp <- sqlQuery(dbrepcard_prod, "SELECT [School_Code], [School_Year], [Student_Group], [Metric], [NSize], [SchoolScore], [AverageScore]
FROM [dbo].[equity_longitudinal] WHERE [Metric] in ('Suspended 1+','Suspended 11+','Total Suspensions')")
)
susp <- sqlQuery(dbrepcard_prod, "SELECT [School_Code], [School_Year], [Student_Group], [Metric], [NSize], [SchoolScore], [AverageScore]
FROM [dbo].[equity_longitudinal] WHERE [Metric] in ('Suspended 1+','Suspended 11+','Total Suspensions')")
head(susp)
table(susp$School_Year)
table(susp$Student_Group)
susp <- subset(susp, !is.na(School_Code))
table(susp$Student_Group)
susp_long <- melt(susp, id.vars = c("School_Year", "School_Code", "Student_Group", "Metric"))
head(susp_long)
susp_long$Metric<- paste0(susp_long$Metric, "_",susp_long$variable)
head(susp_long)
susp_long$variable <- NULL
head(susp_long)
susp_wide <- dcast(susp_long, School_Year + School_Code + Student_Group ~ Metric, value.var = "value")
head(susp_long)
susp <- sqlQuery(dbrepcard_prod, "SELECT [School_Code], [School_Year], [Student_Group], [Metric], [NSize], [SchoolScore], [AverageScore]
FROM [dbo].[equity_longitudinal] WHERE [Metric] in ('Suspended 1+','Suspended 11+','Total Suspensions')")
susp <- subset(susp, !is.na(School_Code))
susp_long <- melt(susp, id.vars = c("School_Year", "School_Code", "Student_Group", "Metric"))
susp_long$Metric<- paste0(susp_long$Metric, "_",susp_long$variable)
susp_long$variable <- NULL
head(susp_long)
head(susp_long$variable)
table(susp_long$variable)
?dcast
head(susp_wide)
head(susp_wide,50)
head(susp_wide,150)
head(susp_wide)
colnames(susp_wide) <- gsub(" ", "_", colnames(susp_wide))
colnames(susp_wide
)
table(susp_wide$Total_Suspensions_AverageScore)
table(is.na(susp_wide$Total_Suspensions_SchoolScore))
table(is.na(susp_wide$Total_Suspensions_SchoolScore), susp_wide$Student_Group)
table(susp_wide$School_Year)
table(is.na(susp_wide$Total_Suspensions_SchoolScore), susp_wide$Student_Group, susp_wide$School_Year)
table(is.na(susp_wide$Total_Suspensions_AverageScore), susp_wide$Student_Group, susp_wide$School_Year)
head(susp_wide)
